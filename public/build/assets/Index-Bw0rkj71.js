import{d as H,r as w,b as K,f as C,w as B,i as m,g as e,u as i,v as O,j as x,t as o,H as L,p as Q,I as X,L as I,c as l,h as y,o as n,F as D,q as P,n as k,k as J,l as W,s as c}from"./app-LMLfy6T_.js";import{_ as Y}from"./AppLayout.vue_vue_type_script_setup_true_lang-Dg9vcmqC.js";import{u as Z}from"./useLoanPolling-B7UzLvEl.js";import{a as ee,B as R}from"./_plugin-vue_export-helper-Cs5A_DpR.js";import{R as te}from"./refresh-cw-CO6h026N.js";import{F as re}from"./filter-CeXdJk36.js";import{S as se}from"./search-SWqZtPYi.js";import{U as oe}from"./user-ZOL3awYl.js";import{T as A}from"./triangle-alert-WMjCWiwQ.js";import{C as j}from"./circle-x-BifxMPWi.js";import{C as M}from"./clock-DEh5UtGW.js";import{C as ae}from"./circle-check-big-BdqqoiHI.js";import{P as de}from"./package-CXZzcXz_.js";import"./utils-DXrZ82kT.js";import"./useForwardExpose-BGfwThGJ.js";import"./VisuallyHidden-B-IbK-2_.js";import"./house-JRBk0Cia.js";import"./createLucideIcon-DAteRrvL.js";import"./Collection-CHrqpE2f.js";import"./index-BP8NaMnx.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./RovingFocusGroup-BtwHaQnx.js";import"./index-Cs2OOWYa.js";import"./log-out-B30-6VwK.js";import"./users-DURgrSZU.js";import"./Breadcrumbs.vue_vue_type_script_setup_true_lang-bAsAvttd.js";import"./chevron-right-ti3lw4Bb.js";const ne={class:"container mx-auto max-w-7xl px-4 py-8"},le={class:"mb-8"},ie={class:"mb-6 flex items-center justify-between"},ce={class:"flex items-center gap-3"},ue={class:"rounded-xl bg-primary/10 p-3"},me={class:"grid grid-cols-2 gap-4 md:grid-cols-4 lg:grid-cols-8"},ge={class:"rounded-xl border border-border bg-card p-4 shadow-sm"},pe={class:"text-2xl font-bold text-foreground"},xe={class:"rounded-xl border border-yellow-200 bg-yellow-50 p-4 shadow-sm dark:border-yellow-800 dark:bg-yellow-900/20"},be={class:"text-2xl font-bold text-yellow-900 dark:text-yellow-100"},fe={class:"rounded-xl border border-blue-200 bg-blue-50 p-4 shadow-sm dark:border-blue-800 dark:bg-blue-900/20"},ve={class:"text-2xl font-bold text-blue-900 dark:text-blue-100"},ye={class:"rounded-xl border border-green-200 bg-green-50 p-4 shadow-sm dark:border-green-800 dark:bg-green-900/20"},ke={class:"text-2xl font-bold text-green-900 dark:text-green-100"},he={class:"rounded-xl border border-red-200 bg-red-50 p-4 shadow-sm dark:border-red-800 dark:bg-red-900/20"},_e={class:"text-2xl font-bold text-red-900 dark:text-red-100"},we={class:"rounded-xl border border-orange-200 bg-orange-50 p-4 shadow-sm dark:border-orange-800 dark:bg-orange-900/20"},Ce={class:"text-2xl font-bold text-orange-900 dark:text-orange-100"},De={class:"rounded-xl border border-gray-200 bg-gray-50 p-4 shadow-sm dark:border-gray-800 dark:bg-gray-900/20"},Pe={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},Ae={class:"rounded-xl border border-slate-200 bg-slate-50 p-4 shadow-sm dark:border-slate-800 dark:bg-slate-900/20"},Fe={class:"text-2xl font-bold text-slate-900 dark:text-slate-100"},Se={class:"mb-6 rounded-xl border border-border bg-card p-6 shadow-sm"},Ve={class:"mb-4 flex items-center gap-2"},Be={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},Le={class:"mb-2 block text-sm font-medium text-foreground"},Re={class:"flex items-end gap-2"},je={class:"overflow-hidden rounded-xl border border-border bg-card shadow-sm"},Me={class:"overflow-x-auto"},Te={class:"w-full"},$e={class:"divide-y divide-border"},Ne={class:"px-4 py-4"},Ue={class:"flex items-center gap-3"},ze={class:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary/10"},Ee={class:"text-sm font-medium text-foreground"},qe={class:"text-xs text-muted-foreground"},Ge={class:"px-4 py-4"},He={class:"flex items-center gap-3"},Ke=["src","alt"],Oe={class:"max-w-xs"},Qe={class:"line-clamp-2 text-sm font-medium text-foreground"},Xe={class:"text-xs text-muted-foreground"},Ie={class:"px-4 py-4"},Je={class:"px-4 py-4 text-sm text-muted-foreground"},We={class:"px-4 py-4 text-sm"},Ye={key:0,class:"block text-xs"},Ze={key:1,class:"text-muted-foreground"},et={class:"px-4 py-4 text-right"},tt={class:"flex justify-end gap-2"},rt=["onClick","disabled"],st={key:0,class:"p-12 text-center"},ot={class:"text-muted-foreground"},at={key:1,class:"border-t border-border px-6 py-4"},dt={class:"flex items-center justify-between"},nt={class:"text-sm text-muted-foreground"},lt={class:"flex gap-2"},Tt=H({__name:"Index",props:{loans:{},stats:{},filters:{}},setup(a){const g=a,T=[{title:"Admin",href:"/admin/dashboard"},{title:"Préstamos",href:"/admin/loans"}],b=w(g.filters.search||""),f=w(g.filters.status||""),d=w(null),F=K(()=>g.filters.status||g.filters.search||g.filters.user_id),S=r=>r?new Date(r).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"N/A",h=r=>{if(!r)return 0;const t=new Date,u=new Date(r).getTime()-t.getTime();return Math.ceil(u/(1e3*60*60*24))},_=r=>{const t=h(r.due_date);switch(r.status){case"pending_pickup":return{text:"Pendiente Preparación",icon:M,class:"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 border border-yellow-300 dark:border-yellow-800"};case"ready_for_pickup":return{text:"Listo para Recoger",icon:de,class:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 border border-blue-300 dark:border-blue-800"};case"active":return t<=0?{text:"Vencido",icon:A,class:"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 border border-red-300 dark:border-red-800"}:t<=3?{text:`Por Vencer (${t}d)`,icon:A,class:"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400 border border-orange-300 dark:border-orange-800"}:{text:"Activo",icon:R,class:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border border-green-300 dark:border-green-800"};case"overdue":return{text:"Vencido",icon:j,class:"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 border border-red-300 dark:border-red-800 animate-pulse"};case"returned":return{text:"Devuelto",icon:ae,class:"bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-400 border border-gray-300 dark:border-gray-800"};case"returned_pending":return{text:"Verificando",icon:M,class:"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 border border-purple-300 dark:border-purple-800 animate-pulse"};case"cancelled":return{text:"Cancelado",icon:j,class:"bg-slate-100 dark:bg-slate-900/30 text-slate-700 dark:text-slate-400 border border-slate-300 dark:border-slate-800"};default:return{text:"Desconocido",icon:A,class:"bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-400 border border-gray-300 dark:border-gray-800"}}},$=r=>{switch(r.status){case"pending_pickup":return[{label:"Marcar como Listo",action:()=>N(r.id),color:"bg-green-600 hover:bg-green-700"},{label:"Cancelar",action:()=>V(r.id),color:"bg-red-600 hover:bg-red-700"}];case"ready_for_pickup":return[{label:"Confirmar Entrega",action:()=>U(r.id),color:"bg-blue-600 hover:bg-blue-700"},{label:"Cancelar",action:()=>V(r.id),color:"bg-red-600 hover:bg-red-700"}];case"active":case"overdue":return[{label:"Marcar como Devuelto",action:()=>z(r.id),color:"bg-green-600 hover:bg-green-700"}];case"returned_pending":return[{label:"Confirmar Devolución",action:()=>E(r.id),color:"bg-green-600 hover:bg-green-700"},{label:"Rechazar",action:()=>q(r.id),color:"bg-red-600 hover:bg-red-700"}];default:return[]}},N=r=>{confirm("¿Marcar este préstamo como listo para recoger?")&&(d.value=r,c.post(`/admin/loans/${r}/mark-ready`,{},{preserveScroll:!0,onFinish:()=>{d.value=null}}))},U=r=>{confirm("¿Confirmar que el usuario recogió el libro?")&&(d.value=r,c.post(`/admin/loans/${r}/activate`,{},{preserveScroll:!0,onFinish:()=>{d.value=null}}))},z=r=>{confirm("¿Marcar este préstamo como devuelto?")&&(d.value=r,c.post(`/admin/loans/${r}/mark-returned`,{},{preserveScroll:!0,onFinish:()=>{d.value=null}}))},E=r=>{confirm("¿Confirmar que el libro ha sido devuelto correctamente?")&&(d.value=r,c.post(`/admin/loans/${r}/verify-return`,{},{preserveScroll:!0,onFinish:()=>{d.value=null}}))},q=r=>{const t=prompt("Ingrese la razón del rechazo:");!t||t.trim()===""||(d.value=r,c.post(`/admin/loans/${r}/reject-return`,{reason:t.trim()},{preserveScroll:!0,onFinish:()=>{d.value=null}}))},V=r=>{const t=prompt("Ingrese la razón de la cancelación:");!t||t.trim()===""||(d.value=r,c.post(`/admin/loans/${r}/cancel`,{reason:t.trim()},{preserveScroll:!0,onFinish:()=>{d.value=null}}))},v=()=>{c.get("/admin/loans",{status:f.value||void 0,search:b.value||void 0},{preserveState:!0,preserveScroll:!0})},G=()=>{b.value="",f.value="",c.get("/admin/loans")};return Z(3e3,["loans","stats"]),(r,t)=>(n(),C(Y,{title:"Gestión de Préstamos",breadcrumbs:T},{default:B(()=>[m(i(O),{title:"Gestión de Préstamos"}),e("div",ne,[e("div",le,[e("div",ie,[e("div",ce,[e("div",ue,[m(i(ee),{class:"h-8 w-8 text-primary"})]),t[3]||(t[3]=e("div",null,[e("h1",{class:"text-3xl font-bold text-foreground"}," Gestión de Préstamos "),e("p",{class:"text-muted-foreground"}," Administra todos los préstamos del sistema ")],-1))]),e("button",{onClick:v,class:"inline-flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-primary-foreground transition-colors hover:bg-primary/90"},[m(i(te),{class:"h-4 w-4"}),t[4]||(t[4]=x(" Actualizar ",-1))])]),e("div",me,[e("div",ge,[t[5]||(t[5]=e("p",{class:"mb-1 text-xs text-muted-foreground"},"Total",-1)),e("p",pe,o(a.stats.total),1)]),e("div",xe,[t[6]||(t[6]=e("p",{class:"mb-1 text-xs text-yellow-700 dark:text-yellow-400"}," Pendientes ",-1)),e("p",be,o(a.stats.pending_pickup),1)]),e("div",fe,[t[7]||(t[7]=e("p",{class:"mb-1 text-xs text-blue-700 dark:text-blue-400"}," Listos ",-1)),e("p",ve,o(a.stats.ready_for_pickup),1)]),e("div",ye,[t[8]||(t[8]=e("p",{class:"mb-1 text-xs text-green-700 dark:text-green-400"}," Activos ",-1)),e("p",ke,o(a.stats.active),1)]),e("div",he,[t[9]||(t[9]=e("p",{class:"mb-1 text-xs text-red-700 dark:text-red-400"}," Vencidos ",-1)),e("p",_e,o(a.stats.overdue),1)]),e("div",we,[t[10]||(t[10]=e("p",{class:"mb-1 text-xs text-orange-700 dark:text-orange-400"}," Por Vencer ",-1)),e("p",Ce,o(a.stats.overdue_soon),1)]),e("div",De,[t[11]||(t[11]=e("p",{class:"mb-1 text-xs text-gray-700 dark:text-gray-400"}," Devueltos ",-1)),e("p",Pe,o(a.stats.returned),1)]),e("div",Ae,[t[12]||(t[12]=e("p",{class:"mb-1 text-xs text-slate-700 dark:text-slate-400"}," Cancelados ",-1)),e("p",Fe,o(a.stats.cancelled||0),1)])])]),e("div",Se,[e("div",Ve,[m(i(re),{class:"h-5 w-5 text-muted-foreground"}),t[13]||(t[13]=e("h2",{class:"text-lg font-semibold text-foreground"}," Filtros ",-1))]),e("div",Be,[e("div",null,[e("label",Le,[m(i(se),{class:"mr-1 inline h-4 w-4"}),t[14]||(t[14]=x(" Buscar ",-1))]),L(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>b.value=s),type:"text",placeholder:"Usuario, DNI, libro...",class:"w-full rounded-lg border border-border bg-background px-4 py-2 text-foreground focus:border-transparent focus:ring-2 focus:ring-primary",onKeyup:Q(v,["enter"])},null,544),[[X,b.value]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"mb-2 block text-sm font-medium text-foreground"},"Estado",-1)),L(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>f.value=s),class:"w-full rounded-lg border border-border bg-background px-4 py-2 text-foreground focus:border-transparent focus:ring-2 focus:ring-primary",onChange:v},[...t[15]||(t[15]=[e("option",{value:""},"Todos",-1),e("option",{value:"pending_pickup"}," Pendiente Preparación ",-1),e("option",{value:"ready_for_pickup"}," Listo para Recoger ",-1),e("option",{value:"active"},"Activo",-1),e("option",{value:"overdue"},"Vencido",-1),e("option",{value:"returned"},"Devuelto",-1),e("option",{value:"returned_pending"},"Verificando Devolución",-1),e("option",{value:"cancelled"},"Cancelado",-1)])],544),[[I,f.value]])]),e("div",Re,[e("button",{onClick:v,class:"rounded-lg bg-primary px-6 py-2 font-medium text-primary-foreground transition-colors hover:bg-primary/90"}," Aplicar "),F.value?(n(),l("button",{key:0,onClick:G,class:"rounded-lg bg-muted px-6 py-2 font-medium text-muted-foreground transition-colors hover:bg-muted/80"}," Limpiar ")):y("",!0)])])]),e("div",je,[e("div",Me,[e("table",Te,[t[17]||(t[17]=e("thead",{class:"border-b border-border bg-muted/50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium tracking-wider text-muted-foreground uppercase"}," Usuario "),e("th",{class:"px-4 py-3 text-left text-xs font-medium tracking-wider text-muted-foreground uppercase"}," Libro "),e("th",{class:"px-4 py-3 text-left text-xs font-medium tracking-wider text-muted-foreground uppercase"}," Estado "),e("th",{class:"px-4 py-3 text-left text-xs font-medium tracking-wider text-muted-foreground uppercase"}," Fecha Préstamo "),e("th",{class:"px-4 py-3 text-left text-xs font-medium tracking-wider text-muted-foreground uppercase"}," Vencimiento "),e("th",{class:"px-4 py-3 text-right text-xs font-medium tracking-wider text-muted-foreground uppercase"}," Acciones ")])],-1)),e("tbody",$e,[(n(!0),l(D,null,P(a.loans.data,s=>(n(),l("tr",{key:s.id,class:"transition-colors hover:bg-muted/30"},[e("td",Ne,[e("div",Ue,[e("div",ze,[m(i(oe),{class:"h-5 w-5 text-primary"})]),e("div",null,[e("p",Ee,o(s.user.name)+" "+o(s.user.last_name),1),e("p",qe," DNI: "+o(s.user.dni),1)])])]),e("td",Ge,[e("div",He,[e("img",{src:s.physical_copy.book.cover_url||"/images/book-placeholder.svg",alt:s.physical_copy.book.title,class:"h-14 w-10 rounded object-cover shadow-sm",onError:t[2]||(t[2]=u=>{const p=u.target;p.src.includes("placeholder")||(p.src="/images/book-placeholder.svg")})},null,40,Ke),e("div",Oe,[e("p",Qe,o(s.physical_copy.book.title),1),e("p",Xe," Copia #"+o(s.physical_copy.copy_number),1)])])]),e("td",Ie,[e("span",{class:k([_(s).class,"inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 text-xs font-medium"])},[(n(),C(J(_(s).icon),{class:"h-3.5 w-3.5"})),x(" "+o(_(s).text),1)],2)]),e("td",Je,o(S(s.loan_date)),1),e("td",We,[s.due_date?(n(),l("span",{key:0,class:k(h(s.due_date)<=3&&s.status==="active"?"font-semibold text-red-600 dark:text-red-400":"text-muted-foreground")},[x(o(S(s.due_date))+" ",1),s.status==="active"?(n(),l("span",Ye," ("+o(h(s.due_date))+" días) ",1)):y("",!0)],2)):(n(),l("span",Ze,"-"))]),e("td",et,[e("div",tt,[(n(!0),l(D,null,P($(s),(u,p)=>(n(),l("button",{key:p,onClick:u.action,disabled:d.value===s.id,class:k([u.color,"rounded-lg px-3 py-1.5 text-xs font-medium text-white transition-colors disabled:cursor-not-allowed disabled:opacity-50"])},o(d.value===s.id?"Procesando...":u.label),11,rt))),128))])])]))),128))])])]),a.loans.data.length===0?(n(),l("div",st,[m(i(R),{class:"mx-auto mb-4 h-16 w-16 text-muted-foreground opacity-50"}),t[18]||(t[18]=e("h3",{class:"mb-2 text-xl font-semibold text-foreground"}," No se encontraron préstamos ",-1)),e("p",ot,o(F.value?"Intenta ajustar los filtros":"Aún no hay préstamos en el sistema"),1)])):y("",!0),a.loans.last_page>1?(n(),l("div",at,[e("div",dt,[e("p",nt," Mostrando "+o(a.loans.data.length)+" de "+o(a.loans.total)+" préstamos ",1),e("div",lt,[(n(!0),l(D,null,P(a.loans.last_page,s=>(n(),C(i(W),{key:s,href:`/admin/loans?page=${s}`,class:k([s===a.loans.current_page?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80","rounded-lg px-3 py-1 text-sm font-medium transition-colors"]),"preserve-state":""},{default:B(()=>[x(o(s),1)]),_:2},1032,["href","class"]))),128))])])])):y("",!0)])])]),_:1}))}});export{Tt as default};
