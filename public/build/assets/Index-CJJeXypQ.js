import{d as H,r as C,b as K,f as h,w as T,i as c,g as e,u as n,v as Q,c as l,h as g,j as p,t as o,o as a,H as $,p as X,I as J,L as O,F as E,q as R,n as k,k as j,l as W,s as _}from"./app-LMLfy6T_.js";import{C as V,_ as Y}from"./AppLayout.vue_vue_type_script_setup_true_lang-Dg9vcmqC.js";import{R as Z}from"./refresh-cw-CO6h026N.js";import{C as S}from"./circle-alert-CYnwW9m4.js";import{F as ee}from"./filter-CeXdJk36.js";import{S as te}from"./search-SWqZtPYi.js";import{U as re}from"./user-ZOL3awYl.js";import{B as se}from"./ban-aBNV11z9.js";import{C as D}from"./circle-x-BifxMPWi.js";import{C as oe}from"./circle-check-big-BdqqoiHI.js";import{P as N}from"./package-CXZzcXz_.js";import{C as ae}from"./clock-DEh5UtGW.js";import"./utils-DXrZ82kT.js";import"./useForwardExpose-BGfwThGJ.js";import"./VisuallyHidden-B-IbK-2_.js";import"./house-JRBk0Cia.js";import"./createLucideIcon-DAteRrvL.js";import"./Collection-CHrqpE2f.js";import"./index-BP8NaMnx.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./RovingFocusGroup-BtwHaQnx.js";import"./index-Cs2OOWYa.js";import"./log-out-B30-6VwK.js";import"./_plugin-vue_export-helper-Cs5A_DpR.js";import"./users-DURgrSZU.js";import"./Breadcrumbs.vue_vue_type_script_setup_true_lang-bAsAvttd.js";import"./chevron-right-ti3lw4Bb.js";const de={class:"container mx-auto max-w-7xl px-4 py-8"},le={class:"mb-8"},ne={class:"mb-6 flex items-center justify-between"},ie={class:"flex items-center gap-3"},ce={class:"rounded-xl bg-purple-100 p-3 dark:bg-purple-900/30"},ue={class:"grid grid-cols-2 gap-4 md:grid-cols-3 lg:grid-cols-6"},xe={class:"rounded-xl border border-border bg-card p-4 shadow-sm"},ge={class:"text-2xl font-bold text-foreground"},pe={class:"rounded-xl border border-yellow-200 bg-yellow-50 p-4 shadow-sm dark:border-yellow-800 dark:bg-yellow-900/20"},be={class:"text-2xl font-bold text-yellow-900 dark:text-yellow-100"},me={class:"rounded-xl border border-green-200 bg-green-50 p-4 shadow-sm dark:border-green-800 dark:bg-green-900/20"},fe={class:"text-2xl font-bold text-green-900 dark:text-green-100"},ye={class:"rounded-xl border border-blue-200 bg-blue-50 p-4 shadow-sm dark:border-blue-800 dark:bg-blue-900/20"},he={class:"text-2xl font-bold text-blue-900 dark:text-blue-100"},ke={class:"rounded-xl border border-gray-200 bg-gray-50 p-4 shadow-sm dark:border-gray-800 dark:bg-gray-900/20"},_e={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},ve={class:"rounded-xl border border-red-200 bg-red-50 p-4 shadow-sm dark:border-red-800 dark:bg-red-900/20"},we={class:"text-2xl font-bold text-red-900 dark:text-red-100"},Ce={key:0,class:"mb-6 rounded-xl border border-orange-200 bg-orange-50 p-4 dark:border-orange-800 dark:bg-orange-900/20"},Ee={class:"flex items-center gap-3"},Re={class:"font-semibold text-orange-900 dark:text-orange-100"},Se={class:"mb-6 rounded-xl border border-border bg-card p-6 shadow-sm"},De={class:"mb-4 flex items-center gap-2"},Ne={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},Be={class:"mb-2 block text-sm font-medium text-foreground"},qe={class:"flex items-end gap-2"},Ae={class:"overflow-hidden rounded-xl border border-border bg-card shadow-sm"},Fe={class:"overflow-x-auto"},Ue={class:"w-full"},Le={class:"divide-y divide-border"},Te={class:"px-4 py-4"},$e={key:0,class:"text-center"},je={class:"inline-flex h-10 w-10 items-center justify-center rounded-full bg-yellow-100 dark:bg-yellow-900/30"},Ve={class:"font-bold text-yellow-700 dark:text-yellow-400"},Pe={class:"mt-1 text-xs text-muted-foreground"},Me={key:1,class:"text-muted-foreground"},Ge={class:"px-4 py-4"},Ie={class:"flex items-center gap-3"},ze={class:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-purple-100 dark:bg-purple-900/30"},He={class:"text-sm font-medium text-foreground"},Ke={class:"text-xs text-muted-foreground"},Qe={class:"px-4 py-4"},Xe={class:"flex items-center gap-3"},Je=["src","alt"],Oe={class:"max-w-xs"},We={class:"line-clamp-2 text-sm font-medium text-foreground"},Ye={key:0,class:"text-xs text-muted-foreground"},Ze={class:"px-4 py-4"},et={class:"px-4 py-4 text-sm text-muted-foreground"},tt={class:"px-4 py-4 text-sm"},rt={key:1,class:"text-muted-foreground"},st={class:"px-4 py-4 text-right"},ot={class:"flex justify-end gap-2"},at=["onClick","disabled"],dt={key:0,class:"p-12 text-center"},lt={class:"text-muted-foreground"},nt={key:1,class:"border-t border-border px-6 py-4"},it={class:"flex items-center justify-between"},ct={class:"text-sm text-muted-foreground"},ut={class:"flex gap-2"},Vt=H({__name:"Index",props:{reservations:{},stats:{},filters:{}},setup(d){const b=d,P=[{title:"Admin",href:"/admin/dashboard"},{title:"Reservas",href:"/admin/reservations"}],m=C(b.filters.search||""),f=C(b.filters.status||""),u=C(null),B=K(()=>b.filters.status||b.filters.search),q=s=>s.physical_copy?.book?s.physical_copy.book:s.book?s.book:null,A=s=>q(s)?.title||"Sin título",M=s=>q(s)?.cover_url||"/images/book-placeholder.svg",F=s=>s.physical_copy?.copy_number||null,U=s=>s?new Date(s).toLocaleDateString("es-ES",{month:"short",day:"numeric"}):"N/A",v=s=>{const t=new Date,i=new Date(s).getTime()-t.getTime();return Math.ceil(i/(1e3*60*60*24))},w=s=>{const t=v(s.expiration_date);switch(s.status){case"pending":return{text:`En Cola de Espera${s.queue_position&&s.total_in_queue?` - Posición ${s.queue_position}/${s.total_in_queue}`:""}`,icon:ae,class:"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 border border-yellow-300 dark:border-yellow-800"};case"ready":return t<=1?{text:"Usuario Notificado - Expira Hoy",icon:S,class:"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 border border-red-300 dark:border-red-800 animate-pulse"}:t<=2?{text:`Usuario Notificado - ${t}d restantes`,icon:N,class:"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400 border border-orange-300 dark:border-orange-800"}:{text:`Usuario Notificado - ${t}d restantes`,icon:N,class:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border border-green-300 dark:border-green-800"};case"collected":return{text:"Libro Entregado",icon:oe,class:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 border border-blue-300 dark:border-blue-800"};case"expired":return{text:"Expirado - No llegó a recoger",icon:D,class:"bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-400 border border-gray-300 dark:border-gray-800"};case"cancelled":return{text:"Cancelado",icon:se,class:"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 border border-red-300 dark:border-red-800"};default:return{text:"Desconocido",icon:S,class:"bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-400 border border-gray-300 dark:border-gray-800"}}},G=s=>{switch(s.status){case"pending":return[{label:"Cancelar Reserva",action:()=>L(s.id),color:"bg-red-600 hover:bg-red-700",icon:D}];case"ready":return[{label:"Registrar Entrega",action:()=>I(s.id),color:"bg-green-600 hover:bg-green-700",icon:N},{label:"Cancelar Reserva",action:()=>L(s.id),color:"bg-red-600 hover:bg-red-700",icon:D}];default:return[]}},I=s=>{confirm("¿El usuario está presente para recoger su libro? Se registrará la entrega y se creará el préstamo.")&&(u.value=s,_.post(`/admin/reservations/${s}/convert-to-loan`,{},{preserveScroll:!0,onFinish:()=>{u.value=null}}))},L=s=>{confirm("¿Cancelar esta reserva? Si estaba lista, la copia volverá a estar disponible y se notificará a la siguiente persona en cola.")&&(u.value=s,_.post(`/admin/reservations/${s}/cancel`,{},{preserveScroll:!0,onFinish:()=>{u.value=null}}))},y=()=>{_.get("/admin/reservations",{status:f.value||void 0,search:m.value||void 0},{preserveState:!0,preserveScroll:!0})},z=()=>{m.value="",f.value="",_.get("/admin/reservations")};return(s,t)=>(a(),h(Y,{title:"Gestión de Reservas",breadcrumbs:P},{default:T(()=>[c(n(Q),{title:"Gestión de Reservas"}),e("div",de,[e("div",le,[e("div",ne,[e("div",ie,[e("div",ce,[c(n(V),{class:"h-8 w-8 text-purple-600 dark:text-purple-400"})]),t[3]||(t[3]=e("div",null,[e("h1",{class:"text-3xl font-bold text-foreground"}," Gestión de Reservas "),e("p",{class:"text-muted-foreground"}," Administra la cola de reservas del sistema ")],-1))]),e("button",{onClick:y,class:"inline-flex items-center gap-2 rounded-lg bg-purple-600 px-4 py-2 text-white transition-colors hover:bg-purple-700"},[c(n(Z),{class:"h-4 w-4"}),t[4]||(t[4]=p(" Actualizar ",-1))])]),e("div",ue,[e("div",xe,[t[5]||(t[5]=e("p",{class:"mb-1 text-xs text-muted-foreground"},"Total",-1)),e("p",ge,o(d.stats.total),1)]),e("div",pe,[t[6]||(t[6]=e("p",{class:"mb-1 text-xs text-yellow-700 dark:text-yellow-400"}," En Cola ",-1)),e("p",be,o(d.stats.pending),1)]),e("div",me,[t[7]||(t[7]=e("p",{class:"mb-1 text-xs text-green-700 dark:text-green-400"}," Listas ",-1)),e("p",fe,o(d.stats.ready),1)]),e("div",ye,[t[8]||(t[8]=e("p",{class:"mb-1 text-xs text-blue-700 dark:text-blue-400"}," Recogidas ",-1)),e("p",he,o(d.stats.collected),1)]),e("div",ke,[t[9]||(t[9]=e("p",{class:"mb-1 text-xs text-gray-700 dark:text-gray-400"}," Expiradas ",-1)),e("p",_e,o(d.stats.expired),1)]),e("div",ve,[t[10]||(t[10]=e("p",{class:"mb-1 text-xs text-red-700 dark:text-red-400"}," Canceladas ",-1)),e("p",we,o(d.stats.cancelled),1)])])]),d.stats.ready>0?(a(),l("div",Ce,[e("div",Ee,[c(n(S),{class:"h-5 w-5 shrink-0 text-orange-600 dark:text-orange-400"}),e("div",null,[e("p",Re,o(d.stats.ready)+" "+o(d.stats.ready===1?"usuario notificado":"usuarios notificados"),1),t[11]||(t[11]=e("p",{class:"text-sm text-orange-700 dark:text-orange-300"},' Estos usuarios fueron notificados de que su libro está apartado. Cuando lleguen a la biblioteca, registra la entrega haciendo clic en "Registrar Entrega". ',-1))])])])):g("",!0),e("div",Se,[e("div",De,[c(n(ee),{class:"h-5 w-5 text-muted-foreground"}),t[12]||(t[12]=e("h2",{class:"text-lg font-semibold text-foreground"}," Filtros ",-1))]),e("div",Ne,[e("div",null,[e("label",Be,[c(n(te),{class:"mr-1 inline h-4 w-4"}),t[13]||(t[13]=p(" Buscar ",-1))]),$(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>m.value=r),type:"text",placeholder:"Usuario, DNI, libro...",class:"w-full rounded-lg border border-border bg-background px-4 py-2 text-foreground focus:border-transparent focus:ring-2 focus:ring-purple-500",onKeyup:X(y,["enter"])},null,544),[[J,m.value]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"mb-2 block text-sm font-medium text-foreground"},"Estado",-1)),$(e("select",{"onUpdate:modelValue":t[1]||(t[1]=r=>f.value=r),class:"w-full rounded-lg border border-border bg-background px-4 py-2 text-foreground focus:border-transparent focus:ring-2 focus:ring-purple-500",onChange:y},[...t[14]||(t[14]=[e("option",{value:""},"Todos",-1),e("option",{value:"pending"},"En Cola",-1),e("option",{value:"ready"},"Listas",-1),e("option",{value:"collected"},"Recogidas",-1),e("option",{value:"expired"},"Expiradas",-1),e("option",{value:"cancelled"},"Canceladas",-1)])],544),[[O,f.value]])]),e("div",qe,[e("button",{onClick:y,class:"rounded-lg bg-purple-600 px-6 py-2 font-medium text-white transition-colors hover:bg-purple-700"}," Aplicar "),B.value?(a(),l("button",{key:0,onClick:z,class:"rounded-lg bg-muted px-6 py-2 font-medium text-muted-foreground transition-colors hover:bg-muted/80"}," Limpiar ")):g("",!0)])])]),e("div",Ae,[e("div",Fe,[e("table",Ue,[t[16]||(t[16]=e("thead",{class:"border-b border-border bg-muted/50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium tracking-wider text-muted-foreground uppercase"}," Posición "),e("th",{class:"px-4 py-3 text-left text-xs font-medium tracking-wider text-muted-foreground uppercase"}," Usuario "),e("th",{class:"px-4 py-3 text-left text-xs font-medium tracking-wider text-muted-foreground uppercase"}," Libro "),e("th",{class:"px-4 py-3 text-left text-xs font-medium tracking-wider text-muted-foreground uppercase"}," Estado "),e("th",{class:"px-4 py-3 text-left text-xs font-medium tracking-wider text-muted-foreground uppercase"}," Reservado "),e("th",{class:"px-4 py-3 text-left text-xs font-medium tracking-wider text-muted-foreground uppercase"}," Expira "),e("th",{class:"px-4 py-3 text-right text-xs font-medium tracking-wider text-muted-foreground uppercase"}," Acciones ")])],-1)),e("tbody",Le,[(a(!0),l(E,null,R(d.reservations.data,r=>(a(),l("tr",{key:r.id,class:"transition-colors hover:bg-muted/30"},[e("td",Te,[r.status==="pending"&&r.queue_position?(a(),l("div",$e,[e("div",je,[e("span",Ve,"#"+o(r.queue_position),1)]),e("p",Pe," de "+o(r.total_in_queue),1)])):(a(),l("span",Me,"-"))]),e("td",Ge,[e("div",Ie,[e("div",ze,[c(n(re),{class:"h-5 w-5 text-purple-600 dark:text-purple-400"})]),e("div",null,[e("p",He,o(r.user.name)+" "+o(r.user.last_name),1),e("p",Ke," DNI: "+o(r.user.dni),1)])])]),e("td",Qe,[e("div",Xe,[e("img",{src:M(r),alt:A(r),class:"h-14 w-10 rounded object-cover shadow-sm",onError:t[2]||(t[2]=i=>{const x=i.target;x.src.includes("placeholder")||(x.src="/images/book-placeholder.svg")})},null,40,Je),e("div",Oe,[e("p",We,o(A(r)),1),F(r)?(a(),l("p",Ye," Copia #"+o(F(r)),1)):g("",!0)])])]),e("td",Ze,[e("span",{class:k([w(r).class,"inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 text-xs font-medium whitespace-nowrap"])},[(a(),h(j(w(r).icon),{class:"h-3.5 w-3.5"})),p(" "+o(w(r).text),1)],2)]),e("td",et,o(U(r.reservation_date)),1),e("td",tt,[r.status==="ready"?(a(),l("span",{key:0,class:k(v(r.expiration_date)<=1?"font-semibold text-red-600 dark:text-red-400":v(r.expiration_date)<=2?"text-orange-600 dark:text-orange-400":"text-muted-foreground")},o(U(r.expiration_date)),3)):(a(),l("span",rt,"-"))]),e("td",st,[e("div",ot,[(a(!0),l(E,null,R(G(r),(i,x)=>(a(),l("button",{key:x,onClick:i.action,disabled:u.value===r.id,class:k([i.color,"inline-flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-xs font-medium text-white transition-colors disabled:cursor-not-allowed disabled:opacity-50"])},[(a(),h(j(i.icon),{class:"h-3.5 w-3.5"})),p(" "+o(u.value===r.id?"Procesando...":i.label),1)],10,at))),128))])])]))),128))])])]),d.reservations.data.length===0?(a(),l("div",dt,[c(n(V),{class:"mx-auto mb-4 h-16 w-16 text-muted-foreground opacity-50"}),t[17]||(t[17]=e("h3",{class:"mb-2 text-xl font-semibold text-foreground"}," No se encontraron reservas ",-1)),e("p",lt,o(B.value?"Intenta ajustar los filtros":"Aún no hay reservas en el sistema"),1)])):g("",!0),d.reservations.last_page>1?(a(),l("div",nt,[e("div",it,[e("p",ct," Mostrando "+o(d.reservations.data.length)+" de "+o(d.reservations.total)+" reservas ",1),e("div",ut,[(a(!0),l(E,null,R(d.reservations.last_page,r=>(a(),h(n(W),{key:r,href:`/admin/reservations?page=${r}`,class:k([r===d.reservations.current_page?"bg-purple-600 text-white":"bg-muted text-muted-foreground hover:bg-muted/80","rounded-lg px-3 py-1 text-sm font-medium transition-colors"]),"preserve-state":""},{default:T(()=>[p(o(r),1)]),_:2},1032,["href","class"]))),128))])])])):g("",!0)])])]),_:1}))}});export{Vt as default};
