import{_ as V,a as A}from"./index-DZcfcv8L.js";import{_ as S}from"./index-DdRYoR76.js";import{_ as N}from"./index-BP8NaMnx.js";import{c as _,_ as g,a as x,b as v}from"./CardTitle.vue_vue_type_script_setup_true_lang-G1xx1pv-.js";import{_ as R}from"./CardDescription.vue_vue_type_script_setup_true_lang-C7_bnbMg.js";import{C as E,_ as I}from"./AppLayout.vue_vue_type_script_setup_true_lang-Dg9vcmqC.js";import{d as X,b as h,f as w,w as a,i as s,g as o,u as t,v as J,h as f,j as u,t as d,n as y,o as l,c as n,F as H,q,l as $,k as K,s as Q}from"./app-LMLfy6T_.js";import{u as U}from"./useLoanPolling-B7UzLvEl.js";import{B as F}from"./_plugin-vue_export-helper-Cs5A_DpR.js";import{C as p}from"./clock-DEh5UtGW.js";import{C}from"./circle-alert-CYnwW9m4.js";import{C as k}from"./circle-check-big-BdqqoiHI.js";import{C as M}from"./circle-x-BifxMPWi.js";import"./utils-DXrZ82kT.js";import"./useForwardExpose-BGfwThGJ.js";import"./VisuallyHidden-B-IbK-2_.js";import"./house-JRBk0Cia.js";import"./createLucideIcon-DAteRrvL.js";import"./Collection-CHrqpE2f.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./RovingFocusGroup-BtwHaQnx.js";import"./index-Cs2OOWYa.js";import"./log-out-B30-6VwK.js";import"./users-DURgrSZU.js";import"./Breadcrumbs.vue_vue_type_script_setup_true_lang-bAsAvttd.js";import"./chevron-right-ti3lw4Bb.js";const W={class:"container mx-auto px-4 py-6 sm:px-6 lg:px-8"},Y={class:"mb-6 grid gap-4 md:grid-cols-3"},Z={class:"text-2xl font-bold"},ee={class:"text-2xl font-bold"},te={class:"font-semibold"},se={key:0,class:"space-y-4"},re={class:"flex-shrink-0"},ae=["src","alt"],oe={class:"min-w-0 flex-1"},le={class:"mb-2 flex items-start justify-between gap-2"},de={class:"flex-1"},ie={class:"text-sm text-muted-foreground"},ne={class:"grid grid-cols-1 gap-2 text-sm sm:grid-cols-2"},ue={key:0,class:"flex items-center gap-2 text-muted-foreground"},ce={key:1,class:"flex items-center gap-2 text-muted-foreground"},me={key:2,class:"flex items-center gap-2"},fe={key:0,class:"ml-1"},pe={key:3,class:"flex items-center gap-2 text-amber-600"},be={key:4,class:"flex animate-pulse items-center gap-2 text-cyan-600"},_e={key:0,class:"mt-2 text-sm text-muted-foreground"},ge={key:1,class:"mt-2 text-sm text-muted-foreground italic"},xe={key:2,class:"mt-3 flex justify-end"},ve={key:1,class:"py-12 text-center"},ye={key:0,class:"space-y-3"},ke={class:"flex-shrink-0"},he=["src","alt"],we={class:"min-w-0 flex-1"},Ce={class:"mt-1 flex flex-wrap gap-x-4 gap-y-1 text-sm text-muted-foreground"},Pe={key:0},Le={key:1},$e={key:2},Te={key:1,class:"py-8 text-center text-muted-foreground"},tt=X({__name:"Index",props:{activeLoans:{},loanHistory:{},stats:{}},setup(c){const P=c,z=h(()=>P.activeLoans.length>0),T=h(()=>P.stats.overdue_loans>0),D=h(()=>P.activeLoans.filter(i=>i.status==="ready_for_pickup")),O=h(()=>D.value.length>0);function m(i){return new Date(i).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})}function L(i){if(!i)return null;const r=new Date(i),e=new Date,B=r.getTime()-e.getTime();return Math.ceil(B/(1e3*60*60*24))}function b(i){if(i.status==="pending_pickup")return{variant:"outline",class:"bg-yellow-500/10 text-yellow-600 border-yellow-200 dark:bg-yellow-500/20 dark:text-yellow-400 dark:border-yellow-800",label:"Preparando tu libro",icon:p};if(i.status==="ready_for_pickup")return{variant:"outline",class:"bg-cyan-500/10 text-cyan-600 border-cyan-200 dark:bg-cyan-500/20 dark:text-cyan-400 dark:border-cyan-800 animate-pulse",label:"¡Tu libro está listo!",icon:k};if(i.status==="returned")return{variant:"outline",class:"bg-green-500/10 text-green-600 border-green-200 dark:bg-green-500/20 dark:text-green-400 dark:border-green-800",label:"Devuelto",icon:k};if(i.status==="cancelled")return{variant:"outline",class:"bg-gray-500/10 text-gray-600 border-gray-200 dark:bg-gray-500/20 dark:text-gray-400 dark:border-gray-800",label:"Cancelado",icon:M};if(i.status==="overdue")return{variant:"destructive",class:"bg-red-500/10 text-red-600 border-red-200 dark:bg-red-500/20 dark:text-red-400 dark:border-red-800",label:"Vencido",icon:M};if(i.status==="returned_pending")return{variant:"outline",class:"bg-purple-500/10 text-purple-600 border-purple-200 dark:bg-purple-500/20 dark:text-purple-400 dark:border-purple-800",label:"Verificando Devolución",icon:p};{if(!i.due_date)return{variant:"outline",class:"bg-blue-500/10 text-blue-600 border-blue-200 dark:bg-blue-500/20 dark:text-blue-400 dark:border-blue-800",label:"Activo",icon:p};const r=L(i.due_date);return r!==null&&r<=3?{variant:"outline",class:"bg-orange-500/10 text-orange-600 border-orange-200 dark:bg-orange-500/20 dark:text-orange-400 dark:border-orange-800",label:"Por vencer",icon:C}:{variant:"outline",class:"bg-blue-500/10 text-blue-600 border-blue-200 dark:bg-blue-500/20 dark:text-blue-400 dark:border-blue-800",label:"Activo",icon:p}}}function j(i){return i.physical_copy.book.cover_image||"/images/default-book-cover.jpg"}const G=i=>{confirm("¿Confirmas que has devuelto este libro? El administrador verificará la devolución.")&&Q.post(`/loans/${i}/return`,{},{preserveScroll:!0,onSuccess:()=>{}})};return U(3e3,["activeLoans","loanHistory","stats"]),(i,r)=>(l(),w(I,null,{default:a(()=>[s(t(J),{title:"Mis Préstamos"}),o("div",W,[r[18]||(r[18]=o("div",{class:"mb-6"},[o("h1",{class:"text-3xl font-bold tracking-tight"},"Mis Préstamos"),o("p",{class:"mt-2 text-muted-foreground"}," Gestiona y revisa el estado de tus préstamos de libros ")],-1)),o("div",Y,[s(t(_),null,{default:a(()=>[s(t(g),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(x),{class:"text-sm font-medium"},{default:a(()=>[...r[0]||(r[0]=[u("Total Préstamos",-1)])]),_:1}),s(t(F),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),s(t(v),null,{default:a(()=>[o("div",Z,d(c.stats.total_loans),1),r[1]||(r[1]=o("p",{class:"text-xs text-muted-foreground"}," Préstamos históricos ",-1))]),_:1})]),_:1}),s(t(_),null,{default:a(()=>[s(t(g),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(x),{class:"text-sm font-medium"},{default:a(()=>[...r[2]||(r[2]=[u("Préstamos Activos",-1)])]),_:1}),s(t(p),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),s(t(v),null,{default:a(()=>[o("div",ee,d(c.stats.active_loans),1),r[3]||(r[3]=o("p",{class:"text-xs text-muted-foreground"}," Libros en tu poder ",-1))]),_:1})]),_:1}),s(t(_),null,{default:a(()=>[s(t(g),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(x),{class:"text-sm font-medium"},{default:a(()=>[...r[4]||(r[4]=[u("Préstamos Vencidos",-1)])]),_:1}),s(t(C),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),s(t(v),null,{default:a(()=>[o("div",{class:y(["text-2xl font-bold",T.value?"text-red-600":""])},d(c.stats.overdue_loans),3),r[5]||(r[5]=o("p",{class:"text-xs text-muted-foreground"}," Requieren devolución urgente ",-1))]),_:1})]),_:1})]),O.value?(l(),w(t(V),{key:0,class:"mb-6 border-cyan-200 bg-cyan-50 dark:border-cyan-800 dark:bg-cyan-950"},{default:a(()=>[s(t(k),{class:"h-4 w-4 text-cyan-600"}),s(t(A),{class:"text-cyan-900 dark:text-cyan-100"},{default:a(()=>[o("span",te,"¡Tienes "+d(D.value.length)+" libro(s) esperándote!",1),r[6]||(r[6]=o("span",{class:"ml-1"},"Tu(s) libro(s) ha(n) sido apartado(s) y está(n) listo(s) para recoger en biblioteca.",-1))]),_:1})]),_:1})):f("",!0),T.value?(l(),w(t(V),{key:1,variant:"destructive",class:"mb-6"},{default:a(()=>[s(t(C),{class:"h-4 w-4"}),s(t(A),null,{default:a(()=>[u(" Tienes "+d(c.stats.overdue_loans)+" préstamo(s) vencido(s). Por favor, devuelve los libros lo antes posible. ",1)]),_:1})]),_:1})):f("",!0),s(t(_),{class:"mb-6"},{default:a(()=>[s(t(g),null,{default:a(()=>[s(t(x),null,{default:a(()=>[...r[7]||(r[7]=[u("Préstamos Activos",-1)])]),_:1}),s(t(R),null,{default:a(()=>[...r[8]||(r[8]=[u(" Libros que actualmente tienes en préstamo ",-1)])]),_:1})]),_:1}),s(t(v),null,{default:a(()=>[z.value?(l(),n("div",se,[(l(!0),n(H,null,q(c.activeLoans,e=>(l(),n("div",{key:e.id,class:"flex flex-col gap-4 rounded-lg border p-4 transition-colors hover:bg-accent/50 sm:flex-row"},[o("div",re,[o("img",{src:j(e),alt:e.physical_copy.book.title,class:"h-28 w-20 rounded-md object-cover shadow-sm"},null,8,ae)]),o("div",oe,[o("div",le,[o("div",de,[s(t($),{href:`/books/${e.physical_copy.book.id}`,class:"line-clamp-2 text-lg font-semibold hover:underline"},{default:a(()=>[u(d(e.physical_copy.book.title),1)]),_:2},1032,["href"]),o("p",ie," Código: "+d(e.physical_copy.barcode),1)]),s(t(S),{class:y(b(e).class)},{default:a(()=>[(l(),w(K(b(e).icon),{class:"mr-1 h-3 w-3"})),u(" "+d(b(e).label),1)]),_:2},1032,["class"])]),o("div",ne,[e.loan_date?(l(),n("div",ue,[s(t(E),{class:"h-4 w-4"}),o("span",null,"Prestado: "+d(m(e.loan_date)),1)])):(l(),n("div",ce,[s(t(p),{class:"h-4 w-4"}),o("span",null,"Solicitado: "+d(m(e.created_at)),1)])),e.due_date?(l(),n("div",me,[s(t(E),{class:y(["h-4 w-4",e.status==="overdue"?"text-red-600":"text-muted-foreground"])},null,8,["class"]),o("span",{class:y(e.status==="overdue"?"font-semibold text-red-600":"text-muted-foreground")},[u(" Vence: "+d(m(e.due_date))+" ",1),e.status!=="overdue"&&L(e.due_date)!==null?(l(),n("span",fe," ("+d(L(e.due_date))+" días) ",1)):f("",!0)],2)])):e.status==="pending_pickup"?(l(),n("div",pe,[s(t(C),{class:"h-4 w-4"}),r[9]||(r[9]=o("span",{class:"font-medium"},"En preparación - Te avisaremos cuando esté listo",-1))])):e.status==="ready_for_pickup"?(l(),n("div",be,[s(t(k),{class:"h-4 w-4"}),r[10]||(r[10]=o("span",{class:"font-bold"},"¡Tu libro te está esperando! Recógelo en biblioteca",-1))])):f("",!0)]),e.renewal_count>0?(l(),n("div",_e," Renovaciones: "+d(e.renewal_count),1)):f("",!0),e.notes?(l(),n("div",ge,d(e.notes),1)):f("",!0),["active","overdue"].includes(e.status)?(l(),n("div",xe,[s(t(N),{variant:"outline",size:"sm",class:"text-green-600 hover:text-green-700 hover:bg-green-50 border-green-200 dark:border-green-800 dark:hover:bg-green-900/20",onClick:B=>G(e.id)},{default:a(()=>[s(t(k),{class:"mr-2 h-4 w-4"}),r[11]||(r[11]=u(" Marcar como Devuelto ",-1))]),_:1},8,["onClick"])])):f("",!0)])]))),128))])):(l(),n("div",ve,[s(t(F),{class:"mx-auto h-12 w-12 text-muted-foreground/50"}),r[13]||(r[13]=o("h3",{class:"mt-4 text-lg font-semibold"}," No tienes préstamos activos ",-1)),r[14]||(r[14]=o("p",{class:"mt-2 text-sm text-muted-foreground"}," Explora nuestro catálogo y solicita libros para leer ",-1)),s(t(N),{"as-child":"",class:"mt-4"},{default:a(()=>[s(t($),{href:"/books"},{default:a(()=>[...r[12]||(r[12]=[u(" Ver Catálogo ",-1)])]),_:1})]),_:1})]))]),_:1})]),_:1}),s(t(_),null,{default:a(()=>[s(t(g),null,{default:a(()=>[s(t(x),null,{default:a(()=>[...r[15]||(r[15]=[u("Historial de Préstamos",-1)])]),_:1}),s(t(R),null,{default:a(()=>[...r[16]||(r[16]=[u(" Todos tus préstamos anteriores ",-1)])]),_:1})]),_:1}),s(t(v),null,{default:a(()=>[c.loanHistory.length>0?(l(),n("div",ye,[(l(!0),n(H,null,q(c.loanHistory,e=>(l(),n("div",{key:e.id,class:"flex items-start gap-4 rounded-lg border p-3 transition-colors hover:bg-accent/30"},[o("div",ke,[o("img",{src:j(e),alt:e.physical_copy.book.title,class:"h-16 w-12 rounded object-cover shadow-sm"},null,8,he)]),o("div",we,[s(t($),{href:`/books/${e.physical_copy.book.id}`,class:"line-clamp-1 font-medium hover:underline"},{default:a(()=>[u(d(e.physical_copy.book.title),1)]),_:2},1032,["href"]),o("div",Ce,[e.loan_date&&e.actual_return_date?(l(),n("span",Pe,d(m(e.loan_date))+" - "+d(m(e.actual_return_date)),1)):e.loan_date&&e.due_date?(l(),n("span",Le,d(m(e.loan_date))+" - "+d(m(e.due_date)),1)):(l(),n("span",$e,d(m(e.created_at)),1)),s(t(S),{class:y([b(e).class,"h-5"])},{default:a(()=>[u(d(b(e).label),1)]),_:2},1032,["class"])])])]))),128))])):(l(),n("div",Te,[...r[17]||(r[17]=[o("p",null,"No tienes historial de préstamos",-1)])]))]),_:1})]),_:1})])]),_:1}))}});export{tt as default};
