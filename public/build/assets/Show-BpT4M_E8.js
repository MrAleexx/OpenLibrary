import{u as Y,C as z,S as Q,_ as Z}from"./AppLayout.vue_vue_type_script_setup_true_lang-Dg9vcmqC.js";import{d as ee,a as te,b,r as D,c as s,i as l,u as a,v as oe,w as k,g as t,l as w,j as u,h as i,o,t as c,F as P,q as F,n as x,f as se,k as re,s as ae}from"./app-LMLfy6T_.js";import{C as T}from"./circle-check-big-BdqqoiHI.js";import{C as le}from"./circle-x-BifxMPWi.js";import{D as j}from"./download-CbaCTKRJ.js";import{C as ne}from"./chevron-left-DU7tsMqt.js";import{S as ie}from"./star-BhLIgU2w.js";import{E as de}from"./eye-DS3jVQrj.js";import{U as ce}from"./user-ZOL3awYl.js";import{L as ue,B as me}from"./layers-B-BbvRFx.js";import{F as be}from"./file-text-BPA7HujH.js";import{G as pe}from"./globe-DDpCIurT.js";import{H as ge}from"./hash-B42vCzQp.js";import{C as q}from"./circle-alert-CYnwW9m4.js";import{a as ve}from"./_plugin-vue_export-helper-Cs5A_DpR.js";import{I as V}from"./info-CI2XbLMr.js";import{C as fe}from"./clock-DEh5UtGW.js";import"./utils-DXrZ82kT.js";import"./useForwardExpose-BGfwThGJ.js";import"./VisuallyHidden-B-IbK-2_.js";import"./house-JRBk0Cia.js";import"./createLucideIcon-DAteRrvL.js";import"./Collection-CHrqpE2f.js";import"./index-BP8NaMnx.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./RovingFocusGroup-BtwHaQnx.js";import"./index-Cs2OOWYa.js";import"./log-out-B30-6VwK.js";import"./users-DURgrSZU.js";import"./Breadcrumbs.vue_vue_type_script_setup_true_lang-bAsAvttd.js";import"./chevron-right-ti3lw4Bb.js";const xe={class:"space-y-8 p-6"},he={class:"grid grid-cols-1 gap-8 lg:grid-cols-3"},ke={class:"space-y-6 lg:col-span-1"},ye={class:"sticky top-6"},_e={class:"relative aspect-[2/3] overflow-hidden rounded-xl border border-border bg-muted shadow-2xl"},we=["src","alt"],Ce={key:0,class:"absolute top-4 right-4"},Ee={class:"flex items-center gap-1 rounded-full bg-yellow-500 px-3 py-1.5 text-white shadow-lg"},Ae={class:"grid grid-cols-2 gap-3"},Re={class:"rounded-lg border border-border bg-card p-4 text-center"},Se={class:"text-2xl font-bold text-foreground"},De={class:"rounded-lg border border-border bg-card p-4 text-center"},Te={class:"text-2xl font-bold text-foreground"},He={class:"space-y-6 lg:col-span-2"},Le={class:"mb-4 text-4xl font-bold text-foreground"},Pe={key:0,class:"mb-2 flex items-center gap-2 text-lg text-muted-foreground"},je={key:1,class:"mb-4 flex items-center gap-2 text-sm text-muted-foreground"},qe={key:2,class:"mb-4 flex flex-wrap gap-2"},Be={class:"flex flex-wrap gap-4 text-sm text-muted-foreground"},Ie={key:0,class:"flex items-center gap-1.5"},Ne={key:1,class:"flex items-center gap-1.5"},Fe={key:2,class:"flex items-center gap-1.5"},Ve={key:3,class:"flex items-center gap-1.5"},Xe={key:4,class:"flex items-center gap-1.5"},Oe={class:"flex items-start gap-4"},$e={class:"flex-1"},Me={key:0,class:"mb-4 rounded-lg border border-green-200 bg-green-50 p-3 dark:border-green-800 dark:bg-green-900/20"},Ue={class:"flex items-center gap-2 text-sm text-green-800 dark:text-green-300"},Ge={key:1,class:"mb-4 rounded-lg border border-red-200 bg-red-50 p-3 dark:border-red-800 dark:bg-red-900/20"},Je={class:"flex items-center gap-2 text-sm text-red-800 dark:text-red-300"},Ke={class:"flex flex-wrap gap-3"},We=["disabled"],Ye={key:0},ze={key:1},Qe={key:2},Ze={key:3},et={key:4},tt=["disabled"],ot={key:0},st={key:1},rt=["disabled"],at={key:0},lt={key:1},nt={key:2},it={key:3},dt={key:4},ct=["disabled"],ut={key:0},mt={key:1},bt={key:2},pt={class:"mt-4 space-y-2"},gt={key:0,class:"flex items-start gap-2 text-sm text-muted-foreground"},vt={key:1,class:"flex items-start gap-2 text-sm"},ft={class:"text-success"},xt={key:2,class:"flex items-start gap-2 text-sm text-muted-foreground"},ht={key:3,class:"flex items-start gap-2 text-sm text-muted-foreground"},kt={key:4,class:"flex items-start gap-2 text-sm"},yt={class:"text-warning"},_t={key:5,class:"flex items-start gap-2 text-sm"},wt={class:"text-destructive"},Ct={key:1,class:"rounded-xl border border-border bg-card p-6"},Et={class:"leading-relaxed whitespace-pre-line text-muted-foreground"},At={key:2,class:"rounded-xl border border-border bg-card p-6"},Rt={class:"leading-relaxed whitespace-pre-line text-muted-foreground"},St={key:3,class:"rounded-xl border border-border bg-card p-6"},Dt={class:"space-y-2"},Tt={class:"flex-1"},Ht={class:"mr-2 text-sm font-medium text-primary"},Lt={class:"text-foreground"},Pt={class:"text-sm text-muted-foreground"},jt={key:4,class:"rounded-xl border border-border bg-muted/50 p-6"},qt={class:"text-sm leading-relaxed whitespace-pre-line text-muted-foreground"},po=ee({__name:"Show",props:{book:{},availableCopies:{},userHasReservation:{type:Boolean},userHasActiveLoan:{type:Boolean}},setup(n){const r=n,X=te(),{addToCart:O,removeFromCart:$,isInCart:B,isLoading:h}=Y(),f=b(()=>!!X.props.auth?.user),M=[{title:"Inicio",href:"/"},{title:"Catálogo",href:"/books"},{title:r.book.title,href:`/books/${r.book.id}`}],I=b(()=>!r.book.contributors||r.book.contributors.length===0?[]:r.book.contributors.filter(d=>d.contributor_type==="author").sort((d,e)=>d.sequence_number-e.sequence_number)),N=b(()=>!r.book.contributors||r.book.contributors.length===0?[]:r.book.contributors.filter(d=>d.contributor_type==="editor").sort((d,e)=>d.sequence_number-e.sequence_number)),p=b(()=>r.book.book_type==="physical"||r.book.book_type==="both"),H=b(()=>r.book.downloadable&&(r.book.book_type==="digital"||r.book.book_type==="both")),C=b(()=>f.value&&p.value&&r.availableCopies===0&&!r.userHasReservation&&!r.userHasActiveLoan),L=b(()=>f.value&&H.value),E=b(()=>f.value&&p.value&&r.availableCopies>0&&!B(r.book.id)&&!r.userHasActiveLoan),A=b(()=>B(r.book.id)),U=b(()=>r.book.cover_url||"/images/book-placeholder.svg"),v=b(()=>p.value&&r.availableCopies>0?{text:`${r.availableCopies} ${r.availableCopies===1?"copia disponible":"copias disponibles"}`,icon:T,color:"text-success",bgColor:"bg-success/10",borderColor:"border-success/20"}:p.value&&r.availableCopies===0?{text:"Sin copias disponibles",icon:le,color:"text-destructive",bgColor:"bg-destructive/10",borderColor:"border-destructive/20"}:H.value?{text:"Disponible en formato digital",icon:j,color:"text-primary",bgColor:"bg-primary/10",borderColor:"border-primary/20"}:null),y=D(!1),R=D(!1),_=D(null),S=D(null),G=async()=>{if(!(!E.value||h.value))try{await O(r.book.id)}catch(d){console.error("Error adding to cart:",d)}},J=async()=>{if(!h.value)try{await $(r.book.id)}catch(d){console.error("Error removing from cart:",d)}},K=async()=>{if(!(!C.value||y.value)){y.value=!0,_.value=null,S.value=null;try{const d=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",e=await fetch("/reservations",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":d,"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({book_id:r.book.id})}),m=await e.json();if(!e.ok){_.value=m.error||"Error al crear la reserva";return}S.value=m.message||"Reserva creada exitosamente",setTimeout(()=>{ae.visit("/reservations")},2e3)}catch(d){console.error("Error creating reservation:",d),_.value="Error de conexión al crear la reserva"}finally{y.value=!1}}},W=async()=>{if(!(!L.value||!r.book.pdf_url)){R.value=!0;try{const d=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",e=await fetch("/downloads",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":d,"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({book_id:r.book.id})}),m=await e.json();if(!e.ok){alert(m.error||"Error al descargar el archivo. Por favor intenta de nuevo.");return}const g=document.createElement("a");g.href=r.book.pdf_url,g.download=`${r.book.title}.pdf`,g.target="_blank",document.body.appendChild(g),g.click(),document.body.removeChild(g)}catch(d){console.error("Error downloading book:",d),alert("Error al descargar el archivo. Por favor intenta de nuevo.")}finally{R.value=!1}}};return(d,e)=>(o(),s(P,null,[l(a(oe),{title:n.book.title},null,8,["title"]),l(Z,{breadcrumbs:M},{default:k(()=>[t("div",xe,[l(a(w),{href:"/books",class:"inline-flex items-center gap-2 text-muted-foreground transition-colors hover:text-foreground"},{default:k(()=>[l(a(ne),{class:"h-4 w-4"}),e[1]||(e[1]=u(" Volver al catálogo ",-1))]),_:1}),t("div",he,[t("div",ke,[t("div",ye,[t("div",_e,[t("img",{src:U.value,alt:n.book.title,class:"h-full w-full object-cover",onError:e[0]||(e[0]=m=>{const g=m.target;g.src.includes("placeholder")||(g.src="/images/book-placeholder.svg")})},null,40,we),n.book.featured?(o(),s("div",Ce,[t("div",Ee,[l(a(ie),{class:"h-4 w-4 fill-current"}),e[2]||(e[2]=t("span",{class:"text-xs font-medium"},"Destacado",-1))])])):i("",!0)]),t("div",Ae,[t("div",Re,[l(a(de),{class:"mx-auto mb-2 h-5 w-5 text-primary"}),t("p",Se,c(n.book.total_views||0),1),e[3]||(e[3]=t("p",{class:"text-xs text-muted-foreground"}," Vistas ",-1))]),t("div",De,[l(a(j),{class:"mx-auto mb-2 h-5 w-5 text-primary"}),t("p",Te,c(n.book.total_downloads||0),1),e[4]||(e[4]=t("p",{class:"text-xs text-muted-foreground"}," Descargas ",-1))])])])]),t("div",He,[t("div",null,[t("h1",Le,c(n.book.title),1),I.value.length>0?(o(),s("div",Pe,[l(a(ce),{class:"h-5 w-5"}),t("span",null,"Por "+c(I.value.map(m=>m.full_name).join(", ")),1)])):i("",!0),N.value.length>0?(o(),s("div",je,[t("span",null,"Editor(es): "+c(N.value.map(m=>m.full_name).join(", ")),1)])):i("",!0),n.book.categories&&n.book.categories.length>0?(o(),s("div",qe,[(o(!0),s(P,null,F(n.book.categories,m=>(o(),s("span",{key:m.id,class:"inline-flex items-center gap-1 rounded-full bg-primary/10 px-3 py-1 text-sm text-primary"},[l(a(ue),{class:"h-3 w-3"}),u(" "+c(m.name),1)]))),128))])):i("",!0),t("div",Be,[n.book.publisher?(o(),s("span",Ie,[l(a(me),{class:"h-4 w-4"}),u(" "+c(n.book.publisher.name),1)])):i("",!0),n.book.publication_year?(o(),s("span",Ne,[l(a(z),{class:"h-4 w-4"}),u(" "+c(n.book.publication_year),1)])):i("",!0),n.book.pages?(o(),s("span",Fe,[l(a(be),{class:"h-4 w-4"}),u(" "+c(n.book.pages)+" páginas ",1)])):i("",!0),n.book.language?(o(),s("span",Ve,[l(a(pe),{class:"h-4 w-4"}),u(" "+c(n.book.language.name),1)])):i("",!0),n.book.isbn?(o(),s("span",Xe,[l(a(ge),{class:"h-4 w-4"}),u(" ISBN: "+c(n.book.isbn),1)])):i("",!0)])]),v.value?(o(),s("div",{key:0,class:x(["rounded-xl border p-6 transition-all",[v.value.bgColor,v.value.borderColor]])},[t("div",Oe,[(o(),se(re(v.value.icon),{class:x(["mt-1 h-6 w-6 flex-shrink-0",v.value.color])},null,8,["class"])),t("div",$e,[t("h3",{class:x(["mb-2 font-semibold",v.value.color])}," Disponibilidad ",2),t("p",{class:x(["mb-4 text-sm",v.value.color])},c(v.value.text),3),S.value?(o(),s("div",Me,[t("p",Ue,[l(a(T),{class:"h-4 w-4"}),u(" "+c(S.value),1)])])):i("",!0),_.value?(o(),s("div",Ge,[t("p",Je,[l(a(q),{class:"h-4 w-4"}),u(" "+c(_.value),1)])])):i("",!0),t("div",Ke,[p.value&&!A.value?(o(),s("button",{key:0,onClick:G,disabled:!E.value||a(h),class:x(["inline-flex items-center gap-2 rounded-lg px-6 py-3 font-medium transition-all disabled:cursor-not-allowed disabled:opacity-50",E.value?"bg-primary text-primary-foreground shadow-lg hover:bg-primary/90 hover:shadow-xl":"cursor-not-allowed bg-muted text-muted-foreground"])},[l(a(Q),{class:"h-5 w-5"}),a(h)?(o(),s("span",Ye,"Agregando...")):f.value?r.userHasActiveLoan?(o(),s("span",Qe,"Préstamo activo")):r.availableCopies===0?(o(),s("span",Ze,"No disponible")):(o(),s("span",et,"Agregar al carrito")):(o(),s("span",ze,"Inicia sesión para obtener"))],10,We)):i("",!0),p.value&&A.value?(o(),s("button",{key:1,onClick:J,disabled:a(h),class:"inline-flex items-center gap-2 rounded-lg bg-destructive px-6 py-3 font-medium text-destructive-foreground shadow-lg transition-all hover:bg-destructive/90 hover:shadow-xl disabled:cursor-not-allowed disabled:opacity-50"},[l(a(T),{class:"h-5 w-5"}),a(h)?(o(),s("span",ot,"Quitando...")):(o(),s("span",st,"En el carrito"))],8,tt)):i("",!0),p.value&&r.availableCopies===0?(o(),s("button",{key:2,onClick:K,disabled:!C.value||y.value,class:x(["inline-flex items-center gap-2 rounded-lg px-6 py-3 font-medium transition-all disabled:cursor-not-allowed disabled:opacity-50",C.value?"bg-warning text-warning-foreground hover:bg-warning/90 shadow-lg hover:shadow-xl":"cursor-not-allowed bg-muted text-muted-foreground"])},[l(a(ve),{class:"h-5 w-5"}),r.userHasReservation?(o(),s("span",at,"Ya tienes una reserva")):r.userHasActiveLoan?(o(),s("span",lt,"Préstamo activo")):y.value?(o(),s("span",nt,"Reservando...")):f.value?(o(),s("span",dt,"Reservar para cuando esté disponible")):(o(),s("span",it,"Inicia sesión para reservar"))],10,rt)):i("",!0),H.value?(o(),s("button",{key:3,onClick:W,disabled:!L.value||R.value,class:x(["inline-flex items-center gap-2 rounded-lg px-6 py-3 font-medium transition-all disabled:cursor-not-allowed disabled:opacity-50",L.value?"bg-secondary text-secondary-foreground shadow-lg hover:bg-secondary/90 hover:shadow-xl":"cursor-not-allowed bg-muted text-muted-foreground"])},[l(a(j),{class:"h-5 w-5"}),R.value?(o(),s("span",ut,"Descargando...")):f.value?(o(),s("span",bt,"Descargar PDF")):(o(),s("span",mt,"Inicia sesión para descargar"))],10,ct)):i("",!0)]),t("div",pt,[f.value?i("",!0):(o(),s("div",gt,[l(a(V),{class:"mt-0.5 h-4 w-4 flex-shrink-0"}),t("p",null,[l(a(w),{href:"/login",class:"text-primary hover:underline"},{default:k(()=>[...e[5]||(e[5]=[u("Inicia sesión",-1)])]),_:1}),e[6]||(e[6]=u(" para obtener libros físicos o descargar PDFs ",-1))])])),p.value&&A.value?(o(),s("div",vt,[l(a(T),{class:"text-success mt-0.5 h-4 w-4 flex-shrink-0"}),t("p",ft,[e[8]||(e[8]=u(" Este libro está en tu carrito. ",-1)),l(a(w),{href:"/cart",class:"font-medium underline"},{default:k(()=>[...e[7]||(e[7]=[u("Ver carrito",-1)])]),_:1}),e[9]||(e[9]=u(" para proceder con el préstamo. ",-1))])])):i("",!0),p.value&&E.value?(o(),s("div",xt,[l(a(V),{class:"mt-0.5 h-4 w-4 flex-shrink-0"}),e[10]||(e[10]=t("p",null," Agrégalo al carrito para solicitar el préstamo. El período de préstamo es de 14 días. ",-1))])):i("",!0),p.value&&C.value&&!A.value?(o(),s("div",ht,[l(a(fe),{class:"mt-0.5 h-4 w-4 flex-shrink-0"}),e[11]||(e[11]=t("p",null," También puedes reservarlo y tendrás 48 horas para recogerlo en la biblioteca ",-1))])):i("",!0),r.userHasReservation?(o(),s("div",kt,[l(a(q),{class:"text-warning mt-0.5 h-4 w-4 flex-shrink-0"}),t("p",yt,[e[13]||(e[13]=u(" Ya tienes una reserva pendiente de este libro. Visita ",-1)),l(a(w),{href:"/reservations",class:"underline"},{default:k(()=>[...e[12]||(e[12]=[u("Mis Reservas",-1)])]),_:1}),e[14]||(e[14]=u(" para más detalles ",-1))])])):i("",!0),r.userHasActiveLoan?(o(),s("div",_t,[l(a(q),{class:"mt-0.5 h-4 w-4 flex-shrink-0 text-destructive"}),t("p",wt,[e[16]||(e[16]=u(" Actualmente tienes un préstamo activo de este libro. Para solicitarlo nuevamente, primero debes devolverlo. ",-1)),l(a(w),{href:"/loans",class:"font-medium underline"},{default:k(()=>[...e[15]||(e[15]=[u("Ver mis préstamos",-1)])]),_:1})])])):i("",!0)])])])],2)):i("",!0),n.book.details?.description?(o(),s("div",Ct,[e[17]||(e[17]=t("h2",{class:"mb-3 text-xl font-semibold text-foreground"}," Descripción ",-1)),t("p",Et,c(n.book.details.description),1)])):i("",!0),n.book.details?.summary?(o(),s("div",At,[e[18]||(e[18]=t("h2",{class:"mb-3 text-xl font-semibold text-foreground"}," Resumen ",-1)),t("p",Rt,c(n.book.details.summary),1)])):i("",!0),n.book.contents&&n.book.contents.length>0?(o(),s("div",St,[e[19]||(e[19]=t("h2",{class:"mb-4 text-xl font-semibold text-foreground"}," Contenido ",-1)),t("div",Dt,[(o(!0),s(P,null,F(n.book.contents,m=>(o(),s("div",{key:m.chapter_number,class:"flex items-start justify-between rounded-lg p-3 transition-colors hover:bg-muted"},[t("div",Tt,[t("span",Ht," Capítulo "+c(m.chapter_number),1),t("span",Lt,c(m.title),1)]),t("span",Pt," Pág. "+c(m.page_number),1)]))),128))])])):i("",!0),n.book.details?.notes?(o(),s("div",jt,[e[20]||(e[20]=t("h2",{class:"mb-3 text-xl font-semibold text-foreground"}," Notas Adicionales ",-1)),t("p",qt,c(n.book.details.notes),1)])):i("",!0)])])])]),_:1})],64))}});export{po as default};
